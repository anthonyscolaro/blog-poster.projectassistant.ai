{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <!-- System Overview Cards -->
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="card-body">
                <div class="metric-value text-primary">{{ pipeline_stats.total_runs or 0 }}</div>
                <div class="metric-label">Pipeline Runs</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="card-body">
                <div class="metric-value text-success">{{ pipeline_stats.successful_runs or 0 }}</div>
                <div class="metric-label">Successful Runs</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="card-body">
                <div class="metric-value text-info">{{ vector_stats.total_documents or 0 }}</div>
                <div class="metric-label">Documents Indexed</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="card-body">
                <div class="metric-value text-warning">${{ "%.2f"|format(pipeline_stats.total_cost or 0) }}</div>
                <div class="metric-label">Total Cost</div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Pipeline Status -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-diagram-3"></i> Pipeline Status
                </h5>
                <span class="status-badge status-healthy">Active</span>
            </div>
            <div class="card-body">
                <div class="pipeline-step step-completed">
                    <strong>1. Competitor Monitoring</strong>
                    <div class="small text-muted">Last run: {{ pipeline_stats.last_competitor_scan or 'Never' }}</div>
                </div>
                
                <div class="pipeline-step step-completed">
                    <strong>2. Topic Analysis</strong>
                    <div class="small text-muted">{{ pipeline_stats.topics_analyzed or 0 }} topics analyzed</div>
                </div>
                
                <div class="pipeline-step step-completed">
                    <strong>3. Article Generation</strong>
                    <div class="small text-muted">{{ pipeline_stats.articles_generated or 0 }} articles generated</div>
                </div>
                
                <div class="pipeline-step step-completed">
                    <strong>4. Legal Fact Checking</strong>
                    <div class="small text-muted">{{ pipeline_stats.facts_checked or 0 }} facts verified</div>
                </div>
                
                <div class="pipeline-step step-completed">
                    <strong>5. WordPress Publishing</strong>
                    <div class="small text-muted">{{ pipeline_stats.articles_published or 0 }} published</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history"></i> Recent Activity
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% if pipeline_stats.recent_activities %}
                        {% for activity in pipeline_stats.recent_activities %}
                        <div class="list-group-item d-flex justify-content-between align-items-start">
                            <div>
                                <strong>{{ activity.action }}</strong>
                                <div class="small text-muted">{{ activity.details }}</div>
                            </div>
                            <small class="text-muted">{{ activity.timestamp }}</small>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-info-circle fs-1"></i>
                        <p class="mt-2">No recent activity</p>
                        <button class="btn btn-primary btn-sm" onclick="runPipeline()">
                            <i class="bi bi-play"></i> Run Pipeline
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Performance Chart -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up"></i> Performance Metrics
                </h5>
            </div>
            <div class="card-body">
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <!-- System Health -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-heart-pulse"></i> System Health
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Orchestration Manager</span>
                    <span class="status-badge status-healthy">Healthy</span>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Vector Database</span>
                    <span class="status-badge status-healthy">Connected</span>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>WordPress</span>
                    <span class="status-badge status-warning">Unknown</span>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>AI Services</span>
                    <span class="status-badge status-healthy">Active</span>
                </div>
                
                <div class="mt-3">
                    <a href="/health-dashboard" class="btn btn-outline-primary btn-sm w-100">
                        <i class="bi bi-arrow-right"></i> View Details
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Quick Actions -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-lightning"></i> Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <button class="btn btn-primary w-100 mb-2" onclick="runPipeline()">
                            <i class="bi bi-play-circle"></i> Run Full Pipeline
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-success w-100 mb-2" onclick="generateArticle()">
                            <i class="bi bi-file-plus"></i> Generate Article
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-info w-100 mb-2" onclick="testWordPress()">
                            <i class="bi bi-wordpress"></i> Test WordPress
                        </button>
                    </div>
                    <div class="col-md-3">
                        <a href="/pipeline" class="btn btn-outline-secondary w-100 mb-2">
                            <i class="bi bi-diagram-3"></i> View Pipeline
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Performance Chart
const ctx = document.getElementById('performanceChart').getContext('2d');
const performanceChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'Articles Generated',
            data: [2, 1, 3, 2, 1, 0, 1],
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.1)',
            tension: 0.4
        }, {
            label: 'Success Rate (%)',
            data: [95, 100, 90, 100, 100, 0, 100],
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.1)',
            tension: 0.4,
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Weekly Performance'
            }
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                grid: {
                    drawOnChartArea: false,
                },
            }
        }
    }
});
</script>
{% endblock %}